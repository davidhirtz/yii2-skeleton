var d=(c,r,l)=>new Promise((s,t)=>{var o=e=>{try{a(l.next(e))}catch(i){t(i)}},n=e=>{try{a(l.throw(e))}catch(i){t(i)}},a=e=>e.done?s(e.value):Promise.resolve(e.value).then(o,n);a((l=l.apply(c,r)).next())});var m=document.querySelector('meta[name="csrf-token"]').getAttribute("content");window.customElements.get("file-upload")||window.customElements.define("file-upload",class extends HTMLElement{connectedCallback(){let c=this.querySelector('input[type="file"]');if(!c)return;let r=this.dataset.chunkSize?parseInt(this.dataset.chunkSize):1024*1024*2,l=(s,t,o)=>d(this,null,function*(){let n=new FormData,a=new Headers;if(a.set("X-CSRF-Token",m),t>0||o<s.size){let e=s.slice(t,o);n.append(c.name,new File([e],s.name,{type:s.type})),a.set("Content-Range",`bytes ${t}-${o-1}/${s.size}`)}else n.append(c.name,s);yield fetch(this.dataset.url,{body:n,headers:a,method:"POST"})});c.addEventListener("change",s=>d(this,null,function*(){let t=s.target.files;if(t){console.log("Starting upload of",t.length,"file(s)");for(let o=0;o<t.length;o++){let n=t[o],a=Math.ceil(n.size/r);for(let e=0;e<a;e++){let i=e*r,u=Math.min(i+r,n.size);yield l(n,i,u).then(()=>{console.log("Uploaded chunk",e,"of file",n.name)}).catch(h=>{console.error("Upload failed for chunk",e,"of file",n.name,h),e=a})}}}}))}});
//# sourceMappingURL=FileUpload.js.map
