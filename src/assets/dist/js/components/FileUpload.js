import{a as g}from"../chunk-KKRCZ3SV.js";var w=document.querySelector('meta[name="csrf-token"]').getAttribute("content");window.customElements.get("file-upload")||window.customElements.define("file-upload",class extends HTMLElement{connectedCallback(){let l=this.querySelector('input[type="file"]');if(!l)return;let f=(this.dataset.target?document.querySelector(this.dataset.target):null)||document.body,u=this.querySelector("button"),o=this.dataset.chunkSize?parseInt(this.dataset.chunkSize):1024*1024*2,y=o*3;l.addEventListener("change",async b=>{let n=b.target.files;if(!n)return;let h=0;for(let e=0;e<n.length;e++)h+=n[e].size;let s=h>y?document.createElement("progress"):null;s&&(s.className="progress",s.max=h,s.value=0,f.appendChild(s)),u.disabled=!0;for(let e=0;e<n.length;e++){let t=n[e],p=Math.ceil(t.size/o);for(let c=0;c<p;c++){let m=new FormData,r=new Headers,i=c*o,d=Math.min(i+o,t.size);if(i>0||d<t.size){let a=t.slice(i,d);m.append(l.name,new File([a],t.name,{type:t.type})),r.set("Content-Range",`bytes ${i}-${d-1}/${t.size}`)}else m.append(l.name,t);e<n.length-1&&r.set("Prefer","status=204"),r.set("X-CSRF-Token",w),await fetch(this.dataset.url,{body:m,headers:r,method:"POST"}).then(a=>{a.status===200?a.text().then(k=>{g.swap(f,k,{swapStyle:"outerHTML",swapDelay:0,settleDelay:0,show:"top"},{select:this.dataset.target||void 0})}):a.ok||(alert(a.statusText),c=p),s&&(s.value+=d-i)})}}u.disabled=!1}),u.onclick=()=>l.click()}});
//# sourceMappingURL=FileUpload.js.map
