var d=(r,i,l)=>new Promise((o,t)=>{var a=e=>{try{s(l.next(e))}catch(c){t(c)}},n=e=>{try{s(l.throw(e))}catch(c){t(c)}},s=e=>e.done?o(e.value):Promise.resolve(e.value).then(a,n);s((l=l.apply(r,i)).next())});var f=document.querySelector('meta[name="csrf-token"]').getAttribute("content");window.customElements.get("file-upload")||window.customElements.define("file-upload",class extends HTMLElement{connectedCallback(){let r=this.querySelector('input[type="file"]');if(!r)return;let i=this.dataset.chunkSize?parseInt(this.dataset.chunkSize):1024*1024*2,l=(o,t,a)=>d(this,null,function*(){let n=o.slice(t,a),s=new FormData,e=new Headers;s.append("file",new File([n],o.name,{type:o.type})),e.set("X-CSRF-Token",f),e.set("Content-Range",`bytes ${t}-${a-1}/${o.size}`),yield fetch(this.dataset.url,{body:s,headers:e,method:"POST"})});r.addEventListener("change",o=>d(this,null,function*(){let t=o.target.files;if(t){console.log("Starting upload of",t.length,"file(s)");for(let a=0;a<t.length;a++){let n=t[a],s=Math.ceil(n.size/i);for(let e=0;e<s;e++){let c=e*i,u=Math.min(c+i,n.size);yield l(n,c,u).then(()=>{console.log("Uploaded chunk",e,"of file",n.name)}).catch(h=>{console.error("Upload failed for chunk",e,"of file",n.name,h),e=s})}}}}))}});
//# sourceMappingURL=FileUpload.js.map
