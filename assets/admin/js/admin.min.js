$(function(){function o(t){var e=$(t.data("target")),a=t.data("ajax");$.ajax({url:t.attr("href"),method:t.data("method")||"post",params:t.data("params"),success:function(){e.length&&("remove"===a?e.remove():"success"===a?e.toggleClass("bg-success"):"select"===a&&e.toggleClass("is-selected"))}})}$.expr[":"].contains=$.expr.createPseudo(function(e){return function(t){return 0<=$(t).text().toUpperCase().indexOf(e.toUpperCase())}}),yii.confirm=function(t,e,a){var n=$(this);bootbox.confirm(t,function(t){t?n.data("ajax")?o(n):e&&e():a&&a()})},$("[data-ajax]").click(function(t){var e=$(this);e.data("confirm")||(o($(e)),t.preventDefault())}),$("[data-form-toggle]").change(function(){var l=$(this),s=l.find("option:selected");l.data("targets")&&$(l.data("targets")).each(function(){this.show()}).filter("[data-form-toggle]").trigger("change"),l.data("targets",[]),$.each(l.data("form-toggle"),function(t,e){var a,n,o,r=$.isArray(e[0])?e[0]:[e[0]],i=$.isArray(e[1])?e[1]:[e[1]];for(n=String(s.length?(a=String(r[0]).match(/^data-([\w-]+)/))?s.data(a[1]):l.val():l.prop("checked")?l.val():0),t=0;t<r.length;t++)if(String(r[t])===n){for(o=0;o<i.length;o++)l.data("targets").push($(i[o].match(/^[.#]/)?i[o]:".field-"+i[o]).hide());break}}),Skeleton.toggleHr()}).filter(":visible").trigger("change"),$("[data-form-target]").change(function(){var t,e=$(this),a=e.find("option:selected").data("value"),n=e.data("form-target");for($.isArray(a)||(a=[a]),$.isArray(n)||(n=[n]),t=0;t<n.length;t++)$(n[t].match(/^[.#]/)?n[t]:"#"+n[t]).html(a[t]);Skeleton.toggleHr()}).filter(":visible").trigger("change"),$.fn.signupForm=function(){return $(this).on("beforeValidate",function(){var e=$("#token");e.val()||($("#tz").val(jstz.determine().name()),$("#honeypot").val(""),$.get(e.data("url"),function(t){e.val(t)}))})},$.fn.dropdownFilter=function(){var t=$(this),n=t.find(".dropdown-filter"),o=n.parent().next().nextAll();t.on("shown.bs.dropdown",function(){n.focus()}),n.keyup(function(t){var e,a=n.val();o.show(),""!==a&&(o.not(':contains("'+a+'")').hide(),13===t.which&&(e=o.filter("a:visible").eq(0)).length&&(window.location.href=e.attr("href")))})},$(document).ajaxError(function(t,e){var a=e.responseText;a&&bootbox.alert(a)}),Skeleton.initContent()});var Skeleton={initContent:function(t){var e=$(t||"body");e.find('[data-toggle="tooltip"]').tooltip(),$.hasOwnProperty("timeago")&&e.find(".timeago").timeago(),this.hasJUI()&&e.find(".sortable").each(function(){var t=$(this);t.sortable({axis:"y",handle:".sortable-handle",helper:function(t,e){var a=e.children(),n=e.clone();return n.children().each(function(t){$(this).width(a.eq(t).outerWidth())}),n},update:function(){$.post(t.data("sort-url"),$(this).sortable("serialize"))}})})},replaceWithAjax:function(e,t){var a=this,n=$(e);t=$.extend({url:document.location.href},"string"==typeof t?{url:t}:t||{}),$.ajax(t).done(function(t){a.initContent(n.html($("<div>").html(t).find(e).html()))})},toggleHr:function(){$("hr").each(function(){var t=$(this);t.toggle(0<t.nextUntil("hr").filter(":visible").length)})},hasJUI:function(){return $.hasOwnProperty("ui")}};